
<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Kita Bibliothek</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="Kita Bibliothek">
  <style>
    body { font-family: sans-serif; padding: 10px; margin: 0; background: #f9f9f9; }
    h1 { font-size: 1.5rem; }
    button { padding: 8px 12px; margin: 5px; }
    input, select { margin: 5px 0; padding: 6px; width: 100%; max-width: 300px; }
    .book { border: 1px solid #ccc; padding: 10px; margin: 10px 0; background: #fff; }
    .admin-controls { margin-top: 10px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Kita Bibliothek</h1>
  <div id="login">
    <input type="password" id="adminPass" placeholder="Admin Passwort eingeben">
    <button onclick="login()">Einloggen</button>
  </div>
  <div id="app" class="hidden">
    <input type="text" id="search" placeholder="Suche nach Titel, Schlagwort, Kategorie" oninput="renderBooks()">
    <button onclick="startQRScan()">üì∑ Buch scannen</button>
    <div id="books"></div>
    <button onclick="backup()">üìÅ Backup erstellen</button>
    <input type="file" onchange="restore(event)">
    <button onclick="logout()">üîì Abmelden</button>
  </div>

  <script>
    let books = [
      { id: "B-001", title: "Titel 1", category: "Bilderbuch", tags: ["Hund"], group: "", image: "", qr: "" },
      { id: "B-002", title: "Titel 2", category: "Sachbuch", tags: ["Katze"], group: "", image: "", qr: "" }
    ];
    let isAdmin = false;

    function login() {
      const pw = document.getElementById("adminPass").value;
      if (pw === "admin") {
        isAdmin = true;
        document.getElementById("login").classList.add("hidden");
        document.getElementById("app").classList.remove("hidden");
        document.getElementById("adminPass").value = "";
        renderBooks();
      } else {
        alert("Falsches Passwort");
      }
    }

    function logout() {
      isAdmin = false;
      document.getElementById("app").classList.add("hidden");
      document.getElementById("login").classList.remove("hidden");
      document.getElementById("adminPass").value = "";
    }

    function renderBooks() {
      const list = document.getElementById("books");
      const q = document.getElementById("search").value.toLowerCase();
      list.innerHTML = "";
      books.forEach((book, i) => {
        if (
          book.title.toLowerCase().includes(q) ||
          book.tags.join(",").toLowerCase().includes(q) ||
          book.category.toLowerCase().includes(q)
        ) {
          const div = document.createElement("div");
          div.className = "book";
          div.innerHTML = `
            <strong>${book.id}: ${book.title}</strong><br>
            Kategorie: ${book.category}<br>
            Schlagw√∂rter: ${book.tags.join(", ")}<br>
            Status: ${book.group ? "Ausgeliehen an " + book.group : "Im Schrank"}<br>
            ${isAdmin ? `
              <div class="admin-controls">
                <button onclick="editBook(${i})">Bearbeiten</button>
                <button onclick="deleteBook(${i})">L√∂schen</button>
              </div>
            ` : `
              <button onclick="ausleihen(${i})">Ausleihen</button>
              <button onclick="zurueckstellen(${i})">Zur√ºckstellen</button>
            `}
          `;
          list.appendChild(div);
        }
      });
    }

    function ausleihen(index) {
      const gruppe = prompt("An welche Gruppe ausleihen?");
      if (gruppe) {
        books[index].group = gruppe;
        renderBooks();
      }
    }

    function zurueckstellen(index) {
      if (confirm("Wirklich zur√ºckstellen?")) {
        books[index].group = "";
        renderBooks();
      }
    }

    function editBook(index) {
      const b = books[index];
      const neu = prompt("Titel bearbeiten:", b.title);
      if (neu) {
        b.title = neu;
        renderBooks();
      }
    }

    function deleteBook(index) {
      if (confirm("Wirklich l√∂schen?")) {
        books.splice(index, 1);
        renderBooks();
      }
    }

    function backup() {
      const blob = new Blob([JSON.stringify(books)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "kita_backup.json";
      a.click();
    }

    function restore(e) {
      const file = e.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = () => {
        books = JSON.parse(reader.result);
        renderBooks();
      };
      reader.readAsText(file);
    }

    function startQRScan() {
      alert("üì∑ QR-Scan kommt als N√§chstes ‚Äì Kamera-Integration folgt!");
    }
  </script>
</body>
</html>
